# 04) Combat / Waves / Rules

> 목표: Codex가 전투 시스템을 “규칙 + 데이터(컨텐츠)”로 분리해서 구현할 수 있게 정의한다.

## 1. 전장(보드) 기본안(가정, 변경 가능)
- 전장 타입: **그리드 기반 배치 + 적의 경로(Path)**
- 권장 크기: 5열 × 4행(총 20슬롯)
- 적 스폰: 오른쪽 끝(Spawn Zone)
- 목표: 적이 왼쪽 “성문”에 도달하기 전에 처치
- 성문 HP(=라이프): 20 (적 1마리 누락 시 -1, 보스는 -3 같은 변형 가능)

> Codex 구현 팁: 보드/경로는 타일 맵(배경)과 독립적으로 “슬롯 좌표 배열”로 관리하면 유지보수 쉬움.

## 2. 유닛 배치 규칙(MVP)
- 슬롯 1칸에 유닛 1개
- 유닛은 전투 중 자동 공격(타겟팅 규칙은 아래)
- 유닛 이동 없음(=배치가 전략)

## 3. 타겟팅 규칙(기본)
- 기본 타겟: “사거리 안에서 가장 앞선 적(경로 진행도가 가장 큰 적)”
- 예외:
  - 저격수: HP가 가장 낮은 적
  - 탱커: 근거리 + 어그로(전방 우선)
  - 서포터: 아군 HP가 가장 낮은 대상 치유/버프

## 4. 데미지 모델(단순화 권장)
### 4.1 스탯
- 유닛: `atk`, `atkSpeed`, `critChance`, `critMultiplier`, `range`, `skillCooldown`
- 적: `hp`, `moveSpeed`, `armor`, `resist`, `size`

### 4.2 방어 계산(단순식 예시)
- 물리: `final = raw * 100 / (100 + armor)`
- 마법: `final = raw * 100 / (100 + resist)`
- 크리: `raw *= critMultiplier` (발동 확률 `critChance`)

> Codex: 계산식을 데이터화(밸런스 튜닝 용이). 단, MVP는 하드코딩도 허용.

## 5. 상태이상(Status) (MVP 3종만)
- `Slow`(이속 감소, 2초)
- `Stun`(행동불가, 0.8초)
- `Burn`(도트, 3초)

## 6. 웨이브 구조
### 6.1 웨이브 구성 데이터
- 웨이브는 “스폰 이벤트”의 리스트로 구성
  - 예: `{ "time": 0.0, "enemyId": "goblin", "count": 5, "interval": 0.6 }`
- 웨이브 종료 조건(택1)
  - A) 모든 적 처치
  - B) 제한시간 경과 + 남은 적 자동 소멸(캐주얼용)
- 웨이브 사이 “준비 시간” 10~15초

### 6.2 난이도 스케일(예시)
- 웨이브 n의 HP 배율: `hpMul = 1 + 0.12*(n-1)`
- 웨이브 n의 수량 배율: `countMul = 1 + 0.05*(n-1)` (라운딩)
- 10웨이브마다 엘리트/보스 웨이브

## 7. 보스 설계 원칙
- “한 방에 죽는” 느낌 금지: 텔레그래프(예고) → 대응 기회 제공
- 보스 스킬은 시너지/빌드가 드러나게(예: 광역 방패 → 단일 딜러 필요)

## 8. 전투 로그(디버깅용, 강력 추천)
- 이벤트 예시:
  - `WaveStart(n)`
  - `Spawn(enemyId, instanceId)`
  - `Damage(srcId, dstId, amount, isCrit, tags[])`
  - `StatusApply(dstId, statusId, duration)`
  - `UnitDeath(id)` / `EnemyDeath(id)`
- 이 로그는 “리플레이/밸런스 자동 테스트”의 기반이 됨.

## 9. Codex TODO(개발 설계)
- 전투 루프를 “고정 틱(tick) 시뮬레이션”으로 만들지, “delta-time”으로 할지 결정
- 스폰/타겟팅/데미지/상태이상은 **테스트 가능한 순수 로직(GameCore)** 로 분리
