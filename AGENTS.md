# AGENTS.md — 스크립트기반웹게임 (Codex Agent Guide)

> 목적: 이 저장소(프로젝트)에서 Codex 에이전트가 **게임 전체 컨셉/아키텍처를 이해**하고, 안정적으로 기능을 구현/리팩터링/문서화 할 수 있도록 하는 실행 지침서.

---

## 0) 절대 규칙 (권한/경로/안전)

### 0.1 파일 시스템 경로 정책 (매우 중요)

- **허용(코덱스 전용 경로)**: 이 프로젝트의 **워크스페이스(리포지토리) 루트 아래 경로만** 읽기/쓰기/실행 가능.
  - 예: `./` , `./src/**` , `./server/**` , `./docs/**` , `./assets/**` , `./tools/**` , `./tests/**`
- **금지(시스템 경로 / 워크스페이스 외부)**: 아래 같은 **절대경로** 또는 워크스페이스 밖 경로에 대해선, 작업(읽기/쓰기/삭제/실행) 전 **반드시 사용자(안정환) 허가를 먼저 요청**할 것.
  - 예: `/etc/**`, `/usr/**`, `/bin/**`, `/sbin/**`, `/var/**`, `/opt/**`, `/home/**`, `/root/**`, `/mnt/**`, `C:\Windows\**` 등
- **예외 없음**: 로그/캐시/임시파일 생성도 워크스페이스 내부(`./.tmp`, `./.cache`, `./artifacts`)로만 제한.

### 0.2 네트워크/비밀정보

- 토큰/키/비밀번호/쿠키 등 **비밀정보를 생성·요청·추측하지 말 것**.
- 외부 서비스 연동이 필요하면, **환경변수 이름만 제안**하고 값은 사용자가 주입하도록 안내.

### 0.3 실행/삭제 안전장치

- `rm -rf`, 대량 삭제, DB 마이그레이션/스키마 변경, 대규모 포맷팅은 **사전 설명 + 허가** 후 진행.
- 스크립트 실행은 최소화하고, 실행 전 무엇을 실행하는지/부작용을 명확히 로그로 남길 것.

---

## 1) 프로젝트 한 줄 요약

**RNG(운) 기반 유닛 소환 + 합성/시너지 + 웨이브 디펜스**를 웹에서 플레이 가능한 **2D 캐주얼 디펜스 게임**으로 구현한다.

핵심은 “운빨” 재미를 주되, 운영/밸런싱은 사람이 덜 고생하도록 **스크립트(데이터) 기반 컨텐츠 파이프라인**을 갖춘다.

---

## 2) 게임 컨셉 (Design Pillars)

### 2.1 핵심 재미

- **랜덤 소환(가챠) → 조합(합성/강화) → 시너지(세트/속성) → 웨이브 돌파**
- 짧은 러닝타임(예: 8–12분) + 높은 리플레이성(룬/유물/시드)

### 2.2 플레이 루프

1. 골드/마나 획득
2. 유닛 소환 (확률 테이블)
3. 배치/합성/업그레이드
4. 웨이브 진행(보스/엘리트)
5. 보상 선택(유물/패시브)
6. 다음 웨이브…

### 2.3 컨텐츠를 “스크립트로”

- 유닛/스킬/시너지/웨이브/드랍/상점/이벤트를 **JSON(또는 YAML) 정의**로 관리
- 클라이언트는 “엔진”, 컨텐츠는 “데이터”로 분리

---

## 3) 권장 기술 스택(제안)

> 저장소 실제 스택이 다르면, **기존 스택을 우선**하고 본 문서는 참고로만 사용.

### 3.1 클라이언트(웹)

- **TypeScript + Vite** (번들/개발 서버)
- **Phaser 3** (2D 렌더/애니/물리)
- UI는 2가지 중 하나
  - (A) Phaser 내 UI
  - (B) React/Vue로 메뉴/오버레이, Phaser는 게임 캔버스

### 3.2 서버(선택)

- (선택) **ASP.NET Core Web API + MS-SQL(또는 PostgreSQL)**
- 용도: 계정/클라우드 세이브/리더보드/결제/스킨
- 프로토타입 단계에선 서버 없이 **로컬 세이브**로도 가능

---

## 4) 아키텍처 개요

### 4.1 모듈 분리(클라이언트)

- `GameCore` : 전투/웨이브/룰/시드 RNG/이벤트 로그
- `Content` : 유닛/스킬/시너지/웨이브 정의 로더 + 검증기
- `Render` : 스프라이트/애니메이션/이펙트/VFX
- `UI` : HUD/상점/결과/툴팁
- `Sim` : 밸런스 검증용 헤드리스 시뮬레이터(선택)

### 4.2 데이터-드리븐(스크립트) 컨텐츠

- **정적 정의 파일**(예: `content/*.json`)
  - `units.json` : 유닛 스탯/스킬/애니 키
  - `skills.json` : 트리거/계수/쿨다운/타겟팅
  - `synergies.json` : 조건(예: 3/5/7개) → 버프/효과
  - `waves.json` : 웨이브 구성/스폰 타이밍/보스
  - `loot.json` : 드랍/상점 확률
- 런타임에서 로딩 후 **스키마 검증(Ajv 등)** → 실패 시 개발 단계에서 즉시 알림

### 4.3 재현 가능한 RNG (디버깅/리플레이/치트 대응)

- 모든 런은 `runSeed`로 시작
- 랜덤 결과(소환/드랍/치명타)는 **seeded RNG**에서만 발생
- 중요 이벤트는 `eventLog`로 남김
  - 예: `Summon(unitId)`, `Merge(a,b)->c`, `WaveStart(n)`, `Damage(src,tgt,amount,crit)`

### 4.4 에셋 파이프라인 (AI 생성 포함)

- 원칙: **마스터 캐릭터(일관성) → 애니메이션 시트 → 엔진 임포트**
- 권장 폴더
  - `assets/sprites/characters/<name>/` (PNG 시트)
  - `assets/sprites/vfx/` (투사체/폭발/버프)
  - `assets/ui/` (아이콘/버튼)
  - `assets/meta/` (프레임 데이터, atlas json)
- Ludo 등에서 받은 시트는 **프레임 크기/앵커/피벗**을 메타로 고정

---

## 5) 저장소 구조(권장 예시)

```
.
├─ src/
│  ├─ game/            # GameCore (규칙/전투/웨이브)
│  ├─ content/         # 로더/스키마/검증
│  ├─ render/          # Phaser 씬/스프라이트/애니
│  ├─ ui/              # HUD/상점/툴팁
│  ├─ net/             # (선택) API 클라이언트
│  └─ main.ts
├─ content/            # JSON/YAML 정의 파일
├─ assets/
│  ├─ sprites/
│  ├─ ui/
│  └─ meta/
├─ server/             # (선택) ASP.NET Core
├─ tools/              # 컨텐츠 검증/시뮬레이션/에셋 변환 스크립트
├─ tests/
└─ docs/
```

---

## 6) 구현 우선순위 (Milestone)

### M0 — 플레이 가능한 최소 루프

- 웨이브 스폰/적 이동/공격
- 유닛 배치/공격/업그레이드(최소 3종)
- 랜덤 소환 + 비용

### M1 — 스크립트 기반 컨텐츠

- JSON 스키마 + 검증
- 유닛/웨이브를 데이터로 추가 가능

### M2 — 합성/시너지

- 합성 규칙, 시너지 버프
- UI 툴팁/로그

### M3 — 메타/리더보드(선택)

- 계정/세이브/리더보드

---

## 7) 코딩 규칙/품질

- PR(또는 커밋) 단위는 작게, 변경 이유를 명확히.
- “컨텐츠(데이터) 변경”과 “엔진 로직 변경”을 섞지 말 것.
- 공용 로직은 순수 함수화하여 시뮬레이터/테스트에서 재사용 가능하게.
- 타입/스키마를 최우선(런타임 에러를 데이터 검증 단계로 끌어올리기).

---

## 8) Codex 작업 방식(권장)

1. 작업 범위/파일 목록을 먼저 제시
2. 변경 전/후 동작을 짧게 정의
3. 구현 → 로컬 테스트(가능하면) → 문서/주석 보강
4. 위험 작업(경로/삭제/DB) 또는 워크스페이스 밖 접근은 **반드시 사용자 허가**
